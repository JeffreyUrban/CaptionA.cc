repos:

# Secrets check via detect-secrets
# *** NOTE: Our strategy is to avoid committing anything that even looks like a secret. ***
# Initial setup - snapshot current state
#      detect-secrets scan > .secrets.baseline
# Later, if intentionally adding something that must absolutely look secret-ish
# but isn't (like a test fixture), revise it to look like a placeholder.
# To audit:
#      detect-secrets scan --baseline .secrets.baseline
- repo: https://github.com/Yelp/detect-secrets
  rev: v1.5.0
  hooks:
    - id: detect-secrets
      args: ['--baseline', '.secrets.baseline']

# Python checks
- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.14.11
  hooks:
  - id: ruff
    args:
    - --fix
    files: ^data-pipelines/crop_frames/
  - id: ruff-format
    files: ^data-pipelines/crop_frames/
- repo: https://github.com/RobertCraigie/pyright-python
  rev: v1.1.408
  hooks:
  - id: pyright
    additional_dependencies:
    - typer>=0.9.0
    - rich>=13.0.0
    files: ^src/

# TypeScript checks
- repo: local
  hooks:
  - id: typescript-check
    name: TypeScript Type Check
    entry: bash -c 'cd apps/captionacc-web && npx tsc --noEmit --incremental false'
    language: system
    files: ^apps/captionacc-web/.*\.(ts|tsx)$
    pass_filenames: false
  - id: prettier
    name: Prettier Format
    entry: npx --prefix apps/captionacc-web prettier --write --ignore-unknown
    language: system
    files: ^apps/captionacc-web/.*\.(ts|tsx|js|jsx|json|css|md)$
    pass_filenames: true
  - id: eslint
    name: ESLint
    entry: bash -c 'cd apps/captionacc-web && npx eslint'
    language: system
    files: ^apps/captionacc-web/.*\.(ts|tsx)$
    pass_filenames: true
  - id: block-database-files
    name: Block database files
    entry: Database files must be tracked with DVC, not Git
    language: fail
    files: '\.(db|db-shm|db-wal|sqlite|sqlite3)$'
  - id: block-model-files
    name: Block model checkpoint files
    entry: Model files must be tracked with DVC, not Git
    language: fail
    files: '\.(pt|pth|ckpt|safetensors|bin|h5|pkl|pickle)$'
  - id: block-video-files
    name: Block video files
    entry: Video files must not be committed to Git
    language: fail
    files: '\.(mp4|avi|mov|mkv|wmv|flv|webm)$'
  - id: prevent-data-commits
    name: Prevent data/model commits (comprehensive)
    entry: scripts/check-no-data-in-commit.py
    language: system
    pass_filenames: false
    always_run: true

# General checks
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
  - id: trailing-whitespace
    files: ^data-pipelines/crop_frames/
  - id: end-of-file-fixer
    files: ^data-pipelines/crop_frames/
  - id: check-yaml
    files: ^data-pipelines/crop_frames/
  - id: check-added-large-files
    args: ['--maxkb=1000']  # 1MB limit for data protection
    exclude: '^(\.dvc/|.*\.dvc)$'  # Allow .dvc metadata files
  - id: check-merge-conflict
    files: ^data-pipelines/crop_frames/
  - id: mixed-line-ending
    files: ^data-pipelines/crop_frames/
