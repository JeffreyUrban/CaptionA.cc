# Prefect deployment configuration
#
# Deployment names are auto-detected from the worktree directory name.
# Use the deploy.sh script which handles this automatically:
#
#   ./deploy.sh        # Deploys with auto-detected name (e.g., "claude1")
#   ./deploy.sh prod   # Deploys with name "production"
#
# The __DEPLOY_NAME__ placeholder is replaced by deploy.sh at deploy time.
#
name: captionacc-orchestrator

# Pull step: Uses current working directory (set by deploy.sh)
pull:
  - prefect.deployments.steps.set_working_directory:
      directory: __WORKING_DIR__

# Deployments - __DEPLOY_NAME__ is replaced by deploy.sh
deployments:
  - name: __DEPLOY_NAME__
    entrypoint: flows/upload_and_process_video.py:upload_and_process_video_flow
    work_pool:
      name: captionacc-workers
    tags:
      - upload
      - processing
      - high-priority

  - name: __DEPLOY_NAME__
    entrypoint: flows/layout_annotation.py:download_for_layout_annotation_flow
    work_pool:
      name: captionacc-workers
    tags:
      - download
      - layout-annotation
      - user-initiated

  - name: __DEPLOY_NAME__
    entrypoint: flows/layout_annotation.py:upload_layout_db_flow
    work_pool:
      name: captionacc-workers
    tags:
      - upload
      - layout-annotation
      - user-initiated
      - high-priority

  - name: __DEPLOY_NAME__
    entrypoint: flows/crop_frames_to_webm.py:crop_frames_to_webm_flow
    work_pool:
      name: captionacc-workers
    tags:
      - crop-frames
      - webm
      - user-initiated
      - high-priority

  - name: __DEPLOY_NAME__
    entrypoint: flows/caption_annotation.py:download_for_caption_annotation_flow
    work_pool:
      name: captionacc-workers
    tags:
      - download
      - caption-annotation
      - user-initiated

  - name: __DEPLOY_NAME__
    entrypoint: flows/caption_annotation.py:upload_captions_db_flow
    work_pool:
      name: captionacc-workers
    tags:
      - upload
      - caption-annotation
      - user-initiated
      - high-priority

  - name: __DEPLOY_NAME__
    entrypoint: flows/video_processing.py:process_video_initial_flow
    work_pool:
      name: captionacc-workers
    tags:
      - background
      - full-frames

  - name: __DEPLOY_NAME__
    entrypoint: flows/crop_frames.py:crop_frames_flow
    work_pool:
      name: captionacc-workers
    tags:
      - user-initiated
      - crop-frames

  - name: __DEPLOY_NAME__
    entrypoint: flows/caption_median_ocr.py:caption_median_ocr_flow
    work_pool:
      name: captionacc-workers
    tags:
      - user-initiated
      - median-ocr

  - name: __DEPLOY_NAME__
    entrypoint: flows/base_model_update.py:base_model_update_flow
    work_pool:
      name: captionacc-workers
    tags:
      - admin
      - base-model

  - name: __DEPLOY_NAME__
    entrypoint: flows/video_model_retrain.py:retrain_video_model_flow
    work_pool:
      name: captionacc-workers
    tags:
      - model-retrain
      - medium-priority
