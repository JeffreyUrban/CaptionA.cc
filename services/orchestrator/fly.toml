# Fly.io configuration for CaptionA.cc Orchestrator Service
# See https://fly.io/docs/reference/configuration/ for details

app = "captionacc-orchestrator"
primary_region = "ewr"  # US East (same region as web app)

[build]
  dockerfile = "Dockerfile"

[env]
  # Environment identifier
  ENVIRONMENT = "production"

  # Schema is set in secrets, but can be overridden here for staging
  # SUPABASE_SCHEMA = "captionacc_staging"  # Uncomment for staging deployments

  # Secrets are set via: flyctl secrets set
  # Required secrets:
  #   SUPABASE_URL
  #   SUPABASE_SCHEMA (set to captionacc_production or captionacc_staging)
  #   SUPABASE_SERVICE_ROLE_KEY
  #   PREFECT_API_URL
  #   PREFECT_API_KEY
  #   WASABI_ACCESS_KEY_READWRITE
  #   WASABI_SECRET_KEY_READWRITE
  #   WASABI_BUCKET
  #   WASABI_REGION

  # Prefect worker configuration
  WORKER_CONCURRENCY = "2"
  LOG_LEVEL = "INFO"

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = false  # Keep running for Prefect worker
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]

[[vm]]
  cpu_kind = "shared"
  cpus = 2
  memory_mb = 2048

[deploy]
  # Optional: Run migrations or setup before starting
  # release_command = "python setup.py"
